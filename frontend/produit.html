<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Gestion des Produits</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    button {
      padding: 8px 15px;
      font-size: 16px;
      margin-bottom: 20px;
      cursor: pointer;
    }
    input, select {
      display: block;
      margin-bottom: 10px;
      padding: 5px;
      width: 300px;
    }
    .produit {
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>

  <button onclick="window.location.href='index.html'">← Retour à l'accueil</button>

  <h1>Gestion des Produits</h1>

  <form id="produitForm">
    <input type="text" id="nom" placeholder="Nom du produit" required />
    <input type="number" id="prix" placeholder="Prix (€)" step="0.01" required />
    <input type="text" id="categorie" placeholder="Catégorie (ex: burger, boisson)" required />
    <input type="text" id="description" placeholder="Description du produit" />
    <input type="text" id="image" placeholder="Nom de l'image (ex: produit.jpg)" />
    <select id="disponible">
      <option value="true" selected>Disponible</option>
      <option value="false">Indisponible</option>
    </select>
    <button type="submit">Créer / Modifier</button>
  </form>

  <hr />

  <button onclick="getProducts()">Voir les produits</button>

  <div id="produitsList"></div>

<script>
  const apiUrl = 'http://localhost:3000/api/products';
  let currentEditId = null;

  document.getElementById('produitForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
      nom: document.getElementById('nom').value,
      prix: parseFloat(document.getElementById('prix').value),
      categorie: document.getElementById('categorie').value,
      description: document.getElementById('description').value || '',
      image: document.getElementById('image').value || '',
      disponible: document.getElementById('disponible').value === 'true'
    };

    try {
      let res;
      if (currentEditId) {
        // Modifier produit
        res = await fetch(`${apiUrl}/${currentEditId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      } else {
        // Créer produit
        res = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      }

      const result = await res.json();
      alert(result.message || (currentEditId ? 'Produit modifié !' : 'Produit créé !'));
      resetForm();
      getProducts();
    } catch (err) {
      alert('Erreur lors de l\'opération');
      console.error(err);
    }
  });

  function resetForm() {
    document.getElementById('produitForm').reset();
    currentEditId = null;
    document.querySelector('button[type="submit"]').textContent = 'Créer / Modifier';
  }

  async function getProducts() {
    try {
      const res = await fetch(apiUrl);
      const produits = await res.json();

      const container = document.getElementById('produitsList');
      container.innerHTML = '<h3>Produits :</h3>';

      produits.forEach(prod => {
        const div = document.createElement('div');
        div.className = 'produit';
        div.innerHTML = `
          <strong>${prod.nom}</strong> - ${prod.prix} € <br>
          <em>${prod.categorie}</em><br>
          Description : ${prod.description || 'Aucune'}<br>
          <img src="${prod.image || 'placeholder.jpg'}" alt="${prod.nom}" style="max-width:100px;"><br>
          Disponible : ${prod.disponible ? 'Oui' : 'Non'}<br>
          <button onclick="editProduct('${prod._id}')">Modifier</button>
          <button onclick="deleteProduct('${prod._id}')">Supprimer</button>
        `;
        container.appendChild(div);
      });
    } catch (err) {
      alert('Erreur lors de la récupération des produits');
      console.error(err);
    }
  }

  async function deleteProduct(id) {
    if (!confirm('Voulez-vous vraiment supprimer ce produit ?')) return;
    try {
      await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
      alert('Produit supprimé !');
      getProducts();
    } catch (err) {
      alert('Erreur lors de la suppression');
      console.error(err);
    }
  }

  async function editProduct(id) {
    try {
      const res = await fetch(`${apiUrl}/${id}`);
      const prod = await res.json();

      document.getElementById('nom').value = prod.nom;
      document.getElementById('prix').value = prod.prix;
      document.getElementById('categorie').value = prod.categorie;
      document.getElementById('description').value = prod.description || '';
      document.getElementById('image').value = prod.image || '';
      document.getElementById('disponible').value = prod.disponible ? 'true' : 'false';

      currentEditId = id;
      document.querySelector('button[type="submit"]').textContent = 'Modifier le produit';
    } catch (err) {
      alert('Erreur lors du chargement du produit');
      console.error(err);
    }
  }
</script>
<div id="header"></div>

<script>
  fetch('header.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('header').innerHTML = html;
    });
</script>

</body>
</html>
